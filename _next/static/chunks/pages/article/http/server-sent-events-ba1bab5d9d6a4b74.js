(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3366],{86504:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return R}});var r=t(67294),s=t(9008),a=t.n(s),c=t(55147),i=t(62079),o=t.n(i),l=t(52020),d=t.n(l),u=t(73324),h=t.n(u),v=t(88546),p=t.n(v),m=t(99595),f=t.n(m),x=t(66775),j=t.n(x),b=t(2201),g=t.n(b),w=t(57445),_=t.n(w),N=t(44845),k=t(85893),S=t(11151),Z=t(76315),y=t(38925),T=t(19668);function L(e,n){var t=o()(e);if(d()){var r=d()(e);n&&(r=h()(r).call(r,function(n){return p()(e,n).enumerable})),t.push.apply(t,r)}return t}function C(e){for(var n=1;n<arguments.length;n++){var t,r,s=null!=arguments[n]?arguments[n]:{};n%2?f()(t=L(Object(s),!0)).call(t,function(n){(0,N.Z)(e,n,s[n])}):j()?g()(e,j()(s)):f()(r=L(Object(s))).call(r,function(n){_()(e,n,p()(s,n))})}return e}function I(e){var n=C(C({code:"code",pre:"pre"},(0,S.a)()),e.components);return(0,k.jsx)(n.pre,{children:(0,k.jsx)(n.code,{className:"language-javascript",children:"import http from 'node:http';\nimport { PassThrough } from 'node:stream';\nimport Koa from 'koa';\nimport serve from 'koa-static';\n\nconst app = new Koa();\n\napp.use(serve('lib', { maxage: 0 }));\n\nlet stream;\n\nsetInterval(() => {\n  if (stream) {\n    stream.write(`event: message\ndata: ${ JSON.stringify({ date: new Date().toString() }) }\\n\\n`);\n  }\n}, 1500);\n\napp.use(async function(ctx, next) {\n  if (ctx.url === '/ssg') {\n    ctx.request.socket.setTimeout(0);\n    ctx.req.socket.setNoDelay(true);\n    ctx.req.socket.setKeepAlive(true);\n\n    ctx.set({\n      'Content-Type': 'text/event-stream; charset=utf-8',\n      'Cache-Control': 'no-cache, no-transform',\n      'X-Accel-Buffering': 'no',\n      Connection: 'keep-alive'\n    });\n\n    stream = new PassThrough();\n    ctx.status = 200;\n    ctx.body = stream;\n  }\n});\n\nhttp.createServer(app.callback()).listen(5050);\n"})})}function A(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=C(C({},(0,S.a)()),e.components).wrapper;return n?(0,k.jsx)(n,C(C({},e),{},{children:(0,k.jsx)(I,C({},e))})):I(e)}function E(e,n){var t=o()(e);if(d()){var r=d()(e);n&&(r=h()(r).call(r,function(n){return p()(e,n).enumerable})),t.push.apply(t,r)}return t}function P(e){for(var n=1;n<arguments.length;n++){var t,r,s=null!=arguments[n]?arguments[n]:{};n%2?f()(t=E(Object(s),!0)).call(t,function(n){(0,N.Z)(e,n,s[n])}):j()?g()(e,j()(s)):f()(r=E(Object(s))).call(r,function(n){_()(e,n,p()(s,n))})}return e}function z(e){var n=P(P({code:"code",pre:"pre"},(0,S.a)()),e.components);return(0,k.jsx)(n.pre,{children:(0,k.jsx)(n.code,{className:"language-javascript",children:"const evtSource = new EventSource('/ssg');\n\nevtSource.addEventListener('open', function(event) {\n  console.log('open');\n});\n\nevtSource.addEventListener('message', function(event) {\n  console.log('message: ', event.data);\n});\n"})})}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=P(P({},(0,S.a)()),e.components).wrapper;return n?(0,k.jsx)(n,P(P({},e),{},{children:(0,k.jsx)(z,P({},e))})):z(e)}function q(e,n){var t=o()(e);if(d()){var r=d()(e);n&&(r=h()(r).call(r,function(n){return p()(e,n).enumerable})),t.push.apply(t,r)}return t}function B(e){for(var n=1;n<arguments.length;n++){var t,r,s=null!=arguments[n]?arguments[n]:{};n%2?f()(t=q(Object(s),!0)).call(t,function(n){(0,N.Z)(e,n,s[n])}):j()?g()(e,j()(s)):f()(r=q(Object(s))).call(r,function(n){_()(e,n,p()(s,n))})}return e}var H=Z.Z.Text;function K(e){var n=B(B({div:"div",h1:"h1",h2:"h2",p:"p"},(0,S.a)()),e.components);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(n.h1,{children:"使用Server-sent events，和浏览器单向通信"}),"\n",(0,k.jsx)(n.p,{children:"一个网页获取新的数据通常需要发送一个请求到服务器，也就是向服务器请求的页面。 使用Server-sent events，\n服务器可以在任何时刻向我们的Web页面推送数据。webpack-hot-middleware就是使用Server-sent events来发送热替换消息。"}),"\n",(0,k.jsx)(A,{}),"\n",(0,k.jsxs)(n.p,{children:["在浏览器中，通过\n",(0,k.jsx)(H,{className:"inline-block",code:!0,children:"EventSource"}),"\n来创建一个连接，并监听事件。"]}),"\n",(0,k.jsx)(O,{}),"\n",(0,k.jsx)(y.Z,{type:"info",message:[(0,k.jsx)(n.h2,{className:"mb-0 py-[8px] text-[16px]",children:"参考地址："},"cankaodizhi"),(0,k.jsxs)(n.div,{className:"py-[8px]",children:["Server-sent events：",(0,k.jsx)(T.Z,{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events",children:"https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events"})]},"server-sent-events"),(0,k.jsxs)(n.div,{className:"py-[8px]",children:["Server Sent Events (SSE) Streams with Node and Koa：",(0,k.jsx)(T.Z,{href:"https://medium.com/trabe/server-sent-events-sse-streams-with-node-and-koa-d9330677f0bf",children:"https://medium.com/trabe/server-sent-events-sse-streams-with-node-and-koa-d9330677f0bf"})]},"server-sent-events-sse-streams-with-node-and-koa"),(0,k.jsxs)(n.div,{className:"py-[8px]",children:["webpack-hot-middleware：",(0,k.jsx)(T.Z,{href:"https://github.com/webpack-contrib/webpack-hot-middleware",children:"https://github.com/webpack-contrib/webpack-hot-middleware"})]},"webpack-hot-middleware")]})]})}function X(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=B(B({},(0,S.a)()),e.components).wrapper;return n?(0,k.jsx)(n,B(B({},e),{},{children:(0,k.jsx)(K,B({},e))})):K(e)}var D=function(e){return(0,k.jsx)(c.Z,{children:(0,k.jsx)(X,{})})};function R(e){return(0,k.jsxs)(r.Fragment,{children:[(0,k.jsxs)(a(),{children:[(0,k.jsx)("title",{children:"使用Server-sent events技术，与浏览器单向通信"}),(0,k.jsx)("meta",{name:"keywords",content:"Server-sent events"}),(0,k.jsx)("meta",{name:"description",content:"使用Server-sent events，与浏览器单向通信"})]}),(0,k.jsx)(D,{})]})}},19668:function(e,n,t){"use strict";var r=t(85893);n.Z=function(e){var n=e.href,t=e.className,s=e.children;return(0,r.jsx)("a",{className:t,href:n,target:"_blank",rel:"noopener noreferrer",children:s})}},39243:function(e,n,t){"use strict";var r=t(19623),s=t(73935),a=t(11163),c=t(81860),i=t(18610),o=t(75162),l=t(6171),d=t(76467),u=t(63791),h=t.n(u),v=t(85893),p=c.Z.BackTop;n.Z=function(e){var n=(0,a.useRouter)();return[(0,v.jsxs)("div",{className:h().main,children:[e.goBack?(0,v.jsx)("div",{className:"mb-[16px] text-right",children:(0,v.jsxs)(i.ZP,{onClick:function(e){n.push("/")},children:[(0,v.jsx)(l.Z,{className:"mr-[6px]"}),"返回"]})}):null,null==e?void 0:e.children]},"main"),(0,v.jsx)(d.default,{children:null!=e&&e.goToTop&&("undefined"==typeof document?"undefined":(0,r.Z)(document))==="object"?(0,s.createPortal)((0,v.jsx)(p,{type:"primary",icon:(0,v.jsx)(o.Z,{}),title:"返回顶部",tabIndex:0,role:"button","aria-label":"返回顶部"}),document.body):null},"backTop")]}},31725:function(e,n,t){"use strict";t(64043);var r=t(88946),s=t.n(r),a=t(81290),c=t.n(a),i=t(41664),o=t.n(i),l=t(21612),d=t(78957),u=t(83062),h=t(67337),v=t(32958),p=t.n(v),m=t(96808),f=t(19668),x=t(85893),j=[{href:"/",title:"文章"},{href:"/favorites",title:"收藏夹"},{href:"/project",title:"开源项目"}],b=["github.io","vercel.app"],g=s()(j).call(j,function(e,n){return(0,x.jsx)("li",{className:p().navListItem,children:(0,x.jsx)(o(),{href:e.href,children:e.title})},e.href)});n.Z=function(e){return(0,x.jsx)(l.Z.Header,{className:p().antdHeader,children:(0,x.jsxs)("div",{className:p().header,children:[(0,x.jsx)("nav",{className:p().headerLeft,children:(0,x.jsx)("ul",{className:p().navList,children:g})}),(0,x.jsx)("div",{className:p().headerRight,children:(0,x.jsxs)(d.Z,{size:16,children:[(0,x.jsx)(u.Z,{title:"切换网站地址",children:(0,x.jsx)("a",{className:p().switchAddress,role:"button",tabIndex:0,"aria-label":"切换网站地址",onClick:function(e){var n=window.location,t=n.pathname,r=n.hostname,s=/github\.io/.test(r);window.location.href=new(c())(t,"https://duan602728596.".concat(b[s?1:0],"/"))},children:(0,x.jsx)(h.Z,{className:p().switchAddressIcon})})}),(0,x.jsx)(f.Z,{className:p().githubLink,href:"https://github.com/duan602728596",children:(0,x.jsx)(m.Z,{className:"block w-full h-full",imageClassName:"block w-full h-full",avifSrc:"/images/github.avif",webpSrc:"/images/github.webp",src:"/images/github.png",alt:"github"})})]})})]})})}},96808:function(e,n,t){"use strict";var r=t(85893);n.Z=function(e){var n=e.className,t=e.imageClassName,s=e.avifSrc,a=e.webpSrc,c=e.src,i=e.alt;return(0,r.jsxs)("picture",{className:n,children:[s&&(0,r.jsx)("source",{srcSet:s,type:"image/avif"}),a&&(0,r.jsx)("source",{srcSet:a,type:"image/webp"}),(0,r.jsx)("img",{className:t,src:c,alt:i})]})}},55147:function(e,n,t){"use strict";var r=t(67294),s=t(31725),a=t(39243),c=t(85893);n.Z=function(e){return(0,c.jsxs)(r.Fragment,{children:[(0,c.jsx)(s.Z,{}),(0,c.jsx)(a.Z,{goToTop:!0,goBack:!0,children:e.children})]})}},2068:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/http/server-sent-events",function(){return t(86504)}])},63791:function(e){e.exports={main:"main_main__IZXSv",goToTop:"main_goToTop__Py8c8"}},32958:function(e){e.exports={antdHeader:"nav_antdHeader__eCvl0",header:"nav_header__y1mlw",headerLeft:"nav_headerLeft__PrT7_",headerRight:"nav_headerRight__JfqYP",navList:"nav_navList__3HXot",navListItem:"nav_navListItem__hpAdz",switchAddress:"nav_switchAddress__sVzqD",githubLink:"nav_githubLink__BDzSl",switchAddressIcon:"nav_switchAddressIcon__KLxGG"}}},function(e){e.O(0,[8610,1447,4530,8925,9774,2888,179],function(){return e(e.s=2068)}),_N_E=e.O()}]);