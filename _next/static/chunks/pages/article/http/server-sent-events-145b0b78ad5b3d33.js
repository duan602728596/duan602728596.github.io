(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3366],{2068:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/http/server-sent-events",function(){return t(52552)}])},52552:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return g}});var s=t(85893),r=t(67294),o=t(9008),c=t.n(o),a=t(12424),i=t(11151),l=t(1918),d=t(90578),p=t(74553);function u(e){let n={code:"code",pre:"pre",...(0,i.a)(),...e.components};return(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import http from 'node:http';\nimport { PassThrough } from 'node:stream';\nimport Koa from 'koa';\nimport serve from 'koa-static';\n\nconst app = new Koa();\n\napp.use(serve('lib', { maxage: 0 }));\n\nlet stream;\n\nsetInterval(() => {\n  if (stream) {\n    stream.write(`event: message\ndata: ${ JSON.stringify({ date: new Date().toString() }) }\\n\\n`);\n  }\n}, 1500);\n\napp.use(async function(ctx, next) {\n  if (ctx.url === '/ssg') {\n    ctx.request.socket.setTimeout(0);\n    ctx.req.socket.setNoDelay(true);\n    ctx.req.socket.setKeepAlive(true);\n\n    ctx.set({\n      'Content-Type': 'text/event-stream; charset=utf-8',\n      'Cache-Control': 'no-cache, no-transform',\n      'X-Accel-Buffering': 'no',\n      Connection: 'keep-alive'\n    });\n\n    stream = new PassThrough();\n    ctx.status = 200;\n    ctx.body = stream;\n  }\n});\n\nhttp.createServer(app.callback()).listen(5050);\n"})})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}function m(e){let n={code:"code",pre:"pre",...(0,i.a)(),...e.components};return(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const evtSource = new EventSource('/ssg');\n\nevtSource.addEventListener('open', function(event) {\n  console.log('open');\n});\n\nevtSource.addEventListener('message', function(event) {\n  console.log('message: ', event.data);\n});\n"})})}function v(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}let{Text:x}=l.default;function f(e){let n={div:"div",h1:"h1",h2:"h2",p:"p",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{children:"使用Server-sent events，和浏览器单向通信"}),"\n",(0,s.jsx)(n.p,{children:"一个网页获取新的数据通常需要发送一个请求到服务器，也就是向服务器请求的页面。 使用Server-sent events，\n服务器可以在任何时刻向我们的Web页面推送数据。webpack-hot-middleware就是使用Server-sent events来发送热替换消息。"}),"\n",(0,s.jsx)(h,{}),"\n",(0,s.jsxs)(n.p,{children:["在浏览器中，通过\n",(0,s.jsx)(x,{className:"inline-block",code:!0,children:"EventSource"}),"\n来创建一个连接，并监听事件。"]}),"\n",(0,s.jsx)(v,{}),"\n",(0,s.jsx)(d.Z,{type:"info",message:[(0,s.jsx)(n.h2,{className:"mb-0 py-[8px] text-[16px]",children:"参考地址："},"cankaodizhi"),(0,s.jsxs)(n.div,{className:"py-[8px]",children:["Server-sent events：",(0,s.jsx)(p.Z,{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events",children:"https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events"})]},"server-sent-events"),(0,s.jsxs)(n.div,{className:"py-[8px]",children:["Server Sent Events (SSE) Streams with Node and Koa：",(0,s.jsx)(p.Z,{href:"https://medium.com/trabe/server-sent-events-sse-streams-with-node-and-koa-d9330677f0bf",children:"https://medium.com/trabe/server-sent-events-sse-streams-with-node-and-koa-d9330677f0bf"})]},"server-sent-events-sse-streams-with-node-and-koa"),(0,s.jsxs)(n.div,{className:"py-[8px]",children:["webpack-hot-middleware：",(0,s.jsx)(p.Z,{href:"https://github.com/webpack-contrib/webpack-hot-middleware",children:"https://github.com/webpack-contrib/webpack-hot-middleware"})]},"webpack-hot-middleware")]})]})}function j(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(f,{...e})}):f(e)}var b=function(e){return(0,s.jsx)(a.Z,{children:(0,s.jsx)(j,{})})};function g(e){return(0,s.jsxs)(r.Fragment,{children:[(0,s.jsxs)(c(),{children:[(0,s.jsx)("title",{children:"使用Server-sent events技术，与浏览器单向通信"}),(0,s.jsx)("meta",{name:"keywords",content:"Server-sent events"}),(0,s.jsx)("meta",{name:"description",content:"使用Server-sent events，与浏览器单向通信"})]}),(0,s.jsx)(b,{})]})}},11035:function(e,n,t){"use strict";var s=t(85893),r=t(73935),o=t(39332),c=t(57140),a=t(44594),i=t(84669),l=t(85486),d=t(76467),p=t(45212),u=t.n(p);let{BackTop:h}=c.default;n.Z=function(e){let n=(0,o.useRouter)();return[(0,s.jsxs)("div",{className:u().main,children:[e.goBack?(0,s.jsx)("div",{className:"mb-[16px] text-right",children:(0,s.jsxs)(a.ZP,{onClick:function(e){n.push("/")},children:[(0,s.jsx)(l.Z,{className:"mr-[6px]"}),"返回"]})}):null,e?.children]},"main"),e?.goToTop?(0,s.jsx)(d.default,{children:"object"==typeof document?(0,r.createPortal)((0,s.jsx)(h,{type:"primary",icon:(0,s.jsx)(i.Z,{}),title:"返回顶部",tabIndex:0,role:"button","aria-label":"返回顶部"}),document.body):null},"backTop"):null]}},12424:function(e,n,t){"use strict";var s=t(85893),r=t(1918),o=t(11035);n.Z=function(e){return(0,s.jsx)(o.Z,{goToTop:!0,goBack:!0,children:(0,s.jsx)(r.default,{children:e.children})})}},45212:function(e){e.exports={main:"main_main__IZXSv",goToTop:"main_goToTop__Py8c8"}}},function(e){e.O(0,[4594,2409,578,2888,9774,179],function(){return e(e.s=2068)}),_N_E=e.O()}]);