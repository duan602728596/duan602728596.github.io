(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3366],{2068:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/http/server-sent-events",function(){return t(54607)}])},54607:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return b}});var s=t(85893),r=t(67294),a=t(9008),i=t.n(a),c=t(30673),o=t(11151),l=t(76315),d=t(38925),h=t(39182);function p(e){let n={code:"code",pre:"pre",...(0,o.a)(),...e.components};return(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import http from 'node:http';\nimport { PassThrough } from 'node:stream';\nimport Koa from 'koa';\nimport serve from 'koa-static';\n\nconst app = new Koa();\n\napp.use(serve('lib', { maxage: 0 }));\n\nlet stream;\n\nsetInterval(() => {\n  if (stream) {\n    stream.write(`event: message\ndata: ${ JSON.stringify({ date: new Date().toString() }) }\\n\\n`);\n  }\n}, 1500);\n\napp.use(async function(ctx, next) {\n  if (ctx.url === '/ssg') {\n    ctx.request.socket.setTimeout(0);\n    ctx.req.socket.setNoDelay(true);\n    ctx.req.socket.setKeepAlive(true);\n\n    ctx.set({\n      'Content-Type': 'text/event-stream; charset=utf-8',\n      'Cache-Control': 'no-cache, no-transform',\n      'X-Accel-Buffering': 'no',\n      Connection: 'keep-alive'\n    });\n\n    stream = new PassThrough();\n    ctx.status = 200;\n    ctx.body = stream;\n  }\n});\n\nhttp.createServer(app.callback()).listen(5050);\n"})})}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}function m(e){let n={code:"code",pre:"pre",...(0,o.a)(),...e.components};return(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const evtSource = new EventSource('/ssg');\n\nevtSource.addEventListener('open', function(event) {\n  console.log('open');\n});\n\nevtSource.addEventListener('message', function(event) {\n  console.log('message: ', event.data);\n});\n"})})}function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}let{Text:x}=l.default;function f(e){let n={div:"div",h1:"h1",h2:"h2",p:"p",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{children:"使用Server-sent events，和浏览器单向通信"}),"\n",(0,s.jsx)(n.p,{children:"一个网页获取新的数据通常需要发送一个请求到服务器，也就是向服务器请求的页面。 使用Server-sent events，\n服务器可以在任何时刻向我们的Web页面推送数据。webpack-hot-middleware就是使用Server-sent events来发送热替换消息。"}),"\n",(0,s.jsx)(u,{}),"\n",(0,s.jsxs)(n.p,{children:["在浏览器中，通过\n",(0,s.jsx)(x,{className:"inline-block",code:!0,children:"EventSource"}),"\n来创建一个连接，并监听事件。"]}),"\n",(0,s.jsx)(v,{}),"\n",(0,s.jsx)(d.Z,{type:"info",message:[(0,s.jsx)(n.h2,{className:"mb-0 py-[8px] text-[16px]",children:"参考地址："},"cankaodizhi"),(0,s.jsxs)(n.div,{className:"py-[8px]",children:["Server-sent events：",(0,s.jsx)(h.Z,{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events",children:"https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events"})]},"server-sent-events"),(0,s.jsxs)(n.div,{className:"py-[8px]",children:["Server Sent Events (SSE) Streams with Node and Koa：",(0,s.jsx)(h.Z,{href:"https://medium.com/trabe/server-sent-events-sse-streams-with-node-and-koa-d9330677f0bf",children:"https://medium.com/trabe/server-sent-events-sse-streams-with-node-and-koa-d9330677f0bf"})]},"server-sent-events-sse-streams-with-node-and-koa"),(0,s.jsxs)(n.div,{className:"py-[8px]",children:["webpack-hot-middleware：",(0,s.jsx)(h.Z,{href:"https://github.com/webpack-contrib/webpack-hot-middleware",children:"https://github.com/webpack-contrib/webpack-hot-middleware"})]},"webpack-hot-middleware")]})]})}function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(f,{...e})}):f(e)}var j=function(e){return(0,s.jsx)(c.Z,{children:(0,s.jsx)(g,{})})};function b(e){return(0,s.jsxs)(r.Fragment,{children:[(0,s.jsxs)(i(),{children:[(0,s.jsx)("title",{children:"使用Server-sent events技术，与浏览器单向通信"}),(0,s.jsx)("meta",{name:"keywords",content:"Server-sent events"}),(0,s.jsx)("meta",{name:"description",content:"使用Server-sent events，与浏览器单向通信"})]}),(0,s.jsx)(j,{})]})}},39182:function(e,n,t){"use strict";var s=t(85893),r=t(45697),a=t.n(r);function i(e){let{href:n,className:t,children:r}=e;return(0,s.jsx)("a",{className:t,href:n,target:"_blank",rel:"noopener noreferrer",children:r})}i.propTypes={href:a().string.isRequired,className:a().string,children:a().node.isRequired},n.Z=i},99388:function(e,n,t){"use strict";var s=t(85893),r=t(73935),a=t(45697),i=t.n(a),c=t(11163),o=t(81860),l=t(10932),d=t(75162),h=t(6171),p=t(76467),u=t(63791),m=t.n(u);let{BackTop:v}=o.default;function x(e){let n=(0,c.useRouter)();return[(0,s.jsxs)("div",{className:m().main,children:[e.goBack?(0,s.jsx)("div",{className:"mb-[16px] text-right",children:(0,s.jsxs)(l.ZP,{onClick:function(e){n.push("/")},children:[(0,s.jsx)(h.Z,{className:"mr-[6px]"}),"返回"]})}):null,null==e?void 0:e.children]},"main"),(0,s.jsx)(p.default,{children:(null==e?void 0:e.goToTop)&&"object"==typeof document?(0,r.createPortal)((0,s.jsx)(v,{type:"primary",icon:(0,s.jsx)(d.Z,{}),title:"返回顶部",tabIndex:0,role:"button","aria-label":"返回顶部"}),document.body):null},"backTop")]}x.propTypes={children:i().node,goToTop:i().bool,goBack:i().bool},n.Z=x},43221:function(e,n,t){"use strict";var s=t(85893),r=t(41664),a=t.n(r),i=t(21612),c=t(78957),o=t(83062),l=t(67337),d=t(32958),h=t.n(d),p=t(90791),u=t(39182);let m=["github.io","vercel.app"],v=[{href:"/",title:"文章"},{href:"/favorites",title:"收藏夹"},{href:"/project",title:"开源项目"}].map((e,n)=>(0,s.jsx)("li",{className:h().navListItem,children:(0,s.jsx)(a(),{href:e.href,children:e.title})},e.href));n.Z=function(e){return(0,s.jsx)(i.Z.Header,{className:h().antdHeader,children:(0,s.jsxs)("div",{className:h().header,children:[(0,s.jsx)("nav",{className:h().headerLeft,children:(0,s.jsx)("ul",{className:h().navList,children:v})}),(0,s.jsx)("div",{className:h().headerRight,children:(0,s.jsxs)(c.Z,{size:16,children:[(0,s.jsx)(o.Z,{title:"切换网站地址",children:(0,s.jsx)("a",{className:h().switchAddress,role:"button",tabIndex:0,"aria-label":"切换网站地址",onClick:function(e){let{pathname:n,hostname:t}=window.location,s=/github\.io/.test(t);window.location.href=new URL(n,"https://duan602728596.".concat(m[s?1:0],"/"))},children:(0,s.jsx)(l.Z,{className:h().switchAddressIcon})})}),(0,s.jsx)(u.Z,{className:h().githubLink,href:"https://github.com/duan602728596",children:(0,s.jsx)(p.Z,{className:"block w-full h-full",imageClassName:"block w-full h-full",avifSrc:"/images/github.avif",webpSrc:"/images/github.webp",src:"/images/github.png",alt:"github"})})]})})]})})}},90791:function(e,n,t){"use strict";var s=t(85893),r=t(45697),a=t.n(r);function i(e){let{className:n,imageClassName:t,avifSrc:r,webpSrc:a,src:i,alt:c}=e;return(0,s.jsxs)("picture",{className:n,children:[r&&(0,s.jsx)("source",{srcSet:r,type:"image/avif"}),a&&(0,s.jsx)("source",{srcSet:a,type:"image/webp"}),(0,s.jsx)("img",{className:t,src:i,alt:c})]})}i.propTypes={className:a().string,imageClassName:a().string,avifSrc:a().string,webpSrc:a().string,src:a().string},n.Z=i},30673:function(e,n,t){"use strict";var s=t(85893),r=t(67294),a=t(45697),i=t.n(a),c=t(43221),o=t(99388);function l(e){return(0,s.jsxs)(r.Fragment,{children:[(0,s.jsx)(c.Z,{}),(0,s.jsx)(o.Z,{goToTop:!0,goBack:!0,children:e.children})]})}l.propTypes={children:i().node},n.Z=l},63791:function(e){e.exports={main:"main_main__IZXSv",goToTop:"main_goToTop__Py8c8"}},32958:function(e){e.exports={antdHeader:"nav_antdHeader__eCvl0",header:"nav_header__y1mlw",headerLeft:"nav_headerLeft__PrT7_",headerRight:"nav_headerRight__JfqYP",navList:"nav_navList__3HXot",navListItem:"nav_navListItem__hpAdz",switchAddress:"nav_switchAddress__sVzqD",githubLink:"nav_githubLink__BDzSl",switchAddressIcon:"nav_switchAddressIcon__KLxGG"}}},function(e){e.O(0,[932,1447,4530,8925,2888,9774,179],function(){return e(e.s=2068)}),_N_E=e.O()}]);