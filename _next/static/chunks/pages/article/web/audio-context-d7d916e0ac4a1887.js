(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8719],{22515:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/web/audio-context",function(){return t(20179)}])},20179:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return C}});var o=t(85893),r=t(67294),s=t(9008),a=t.n(s),i=t(26219),l=t(11151),c=t(66252),d=t(41577),h=t(86338),u=t(88265);class p{constructor({canvas:e,buffer:n,defaultStereoPannerValue:t=0}){this.audioContext=new AudioContext,this.source=this.audioContext.createBufferSource(),this.analyser=this.audioContext.createAnalyser(),this.stereoPanner=this.audioContext.createStereoPanner(),this.drawAnalyser=()=>{let e=new Uint8Array(this.analyser.frequencyBinCount);this.canvasContext.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.analyser.getByteTimeDomainData(e),this.canvasContext.beginPath();for(let n=0;n<this.analyser.frequencyBinCount;n+=4){let t=n,o=e[n];0===n?this.canvasContext.moveTo(t,o):this.canvasContext.lineTo(t,o)}this.canvasContext.lineTo(this.canvasWidth,0),this.canvasContext.stroke(),this.timer=requestAnimationFrame(this.drawAnalyser)},this.canvasWidth=e.width,this.canvasHeight=e.height,this.canvasContext=e.getContext("2d"),this.buffer=n}async init(){this.canvasContext.lineWidth=3,this.canvasContext.strokeStyle="rgb(0, 0, 0)",this.source.buffer=await this.audioContext.decodeAudioData(this.buffer),this.source.connect(this.analyser),this.source.connect(this.stereoPanner),this.source.connect(this.audioContext.destination),this.stereoPanner.connect(this.audioContext.destination),this.analyser.fftSize=2048}start(){this.setStereoPannerValue(0),this.timer=requestAnimationFrame(this.drawAnalyser),this.source.start()}stop(){cancelAnimationFrame(this.timer),this.source.stop(),this.audioContext.close()}setStereoPannerValue(e){this.stereoPanner.pan.value=e}}let x=[{label:"左",value:1},{label:"中",value:0},{label:"右",value:-1}];var m=function(e){let[n,t]=(0,r.useState)(0),s=(0,r.useRef)(null),a=(0,r.useRef)(null),i=(0,r.useRef)(null);async function l(e){a.current=new p({canvas:s.current,buffer:i.current}),await a.current.init(),a.current.start()}function c(e){a.current&&(a.current.stop(),a.current=null)}return(0,r.useEffect)(function(){return function(){i.current=null,a?.current?.stop()}},[]),(0,o.jsxs)("div",{children:[(0,o.jsx)("canvas",{ref:s,className:"block mx-auto mb-[8px] border border-black border-solid",width:"512",height:"256"}),(0,o.jsx)("input",{type:"file",onInput:function(e){c();let n=e.target.files[0],t=new FileReader;t.addEventListener("load",function(e){i.current=e.target.result},{once:!0}),t.readAsArrayBuffer(n)}}),(0,o.jsxs)(h.ZP.Group,{className:"ml-[8px]",children:[(0,o.jsx)(h.ZP,{onClick:l,children:"播放"}),(0,o.jsx)(h.ZP,{type:"primary",danger:!0,onClick:c,children:"停止"})]}),(0,o.jsx)(u.ZP.Group,{className:"ml-[8px]",options:x,value:n,onChange:function(e){t(e.target.value),a.current&&a.current.setStereoPannerValue(e.target.value)}})]})};let{Text:f}=c.default;function g(e){let n={code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{children:"AudioContext的使用"}),"\n",(0,o.jsx)(n.h2,{children:"加载音频并播放"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const audioContext = new AudioContext();\n\n// 加载音频文件\nconst res = await fetch('public/1.mp3');\nconst buffer = await res.arrayBuffer();\nconst audioBuffer = await audioContext.decodeAudioData(buffer);\n\n// 播放\nlet source;\n\nsource = audioContext.createBufferSource();\nsource.buffer = audioBuffer;\nsource.connect(audioContext.destination);\nsource.start();\n"})}),"\n",(0,o.jsx)(n.h2,{children:"实时处理音频"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode",children:"Analyser"}),"：表示了一个可以提供实时频域和时域分析信息的节点。"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/BiquadFilterNode",children:"BiquadFilter"}),"：一个简单低阶滤波器（双二阶滤波器）。"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/ChannelMergerNode",children:"ChannelMerger"}),"：不同的单声道输入重新组合成单个输出。"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://developer.mozilla.org/zh-CN/docs/Web/API/ChannelMergerNode/webaudiomerger.png",alt:""})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/ChannelSplitterNode",children:"ChannelSplitter"}),"：将音频源的不同声道分离为一组单声道输出。"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://developer.mozilla.org/en-US/docs/Web/API/ChannelSplitterNode/webaudiosplitter.png",alt:""})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/ConvolverNode",children:"Convolver"}),"：执行线性卷积的 AudioNode，一般用来做音频混响效果。"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/DelayNode",children:"Delay"}),"：表示延迟线。"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://developer.mozilla.org/en-US/docs/Web/API/DelayNode/webaudiodelaynode.png",alt:""})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/DynamicsCompressorNode",children:"DynamicsCompressor"}),"：提供了一个压缩效果器，用以降低信号中最响部分的音量，来协助避免在多个声音同时播放并叠加在一起的时候产生的削波失真。"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/GainNode",children:"Gain"}),"：表示音量的变化。"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/IIRFilterNode",children:"IIRFilter"}),"：一个通用的无限脉冲响应 （IIR） 滤波器;这种类型的滤波器也可用于实现音调控制设备和图形均衡器。"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/OscillatorNode",children:"Oscillator"}),"：表示一个振荡器，它产生一个周期的波形信号（如正弦波）。"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/PannerNode",children:"Panner"}),"：音频源信号在模拟物理空间中的位置、方向和行为。"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://developer.mozilla.org/en-US/docs/Web/API/PannerNode/webaudiopannernode.png",alt:""})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/StereoPannerNode",children:"StereoPannerNode"}),"：一个简单的立体声平移器节点，可用于向左或向右平移音频流。"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://developer.mozilla.org/en-US/docs/Web/API/StereoPannerNode/stereopannernode.png",alt:""})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(d.Z,{href:"https://developer.mozilla.org/en-US/docs/Web/API/WaveShaperNode",children:"WaveShaper"}),"：表示一个非线性的畸变器。"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{children:"上传文件并处理音频"}),"\n",(0,o.jsx)(m,{})]})}function j(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(g,{...e})}):g(e)}var v=function(e){return(0,o.jsx)(i.Z,{children:(0,o.jsx)(j,{})})};function C(e){return(0,o.jsxs)(r.Fragment,{children:[(0,o.jsx)(a(),{children:(0,o.jsx)("title",{children:"AudioContext的使用"})}),(0,o.jsx)(v,{})]})}},94914:function(e,n,t){"use strict";var o=t(85893),r=t(73935),s=t(39332),a=t(29155),i=t(86338),l=t(70612),c=t(30448),d=t(76467),h=t(1294),u=t.n(h);let{BackTop:p}=a.default;n.Z=function(e){let n=(0,s.useRouter)();return[(0,o.jsxs)("div",{className:u().main,children:[e.goBack?(0,o.jsx)("div",{className:"mb-[16px] text-right",children:(0,o.jsxs)(i.ZP,{onClick:function(e){n.push("/")},children:[(0,o.jsx)(c.Z,{className:"mr-[6px]"}),"返回"]})}):null,e?.children]},"main"),e?.goToTop?(0,o.jsx)(d.default,{children:"object"==typeof document?(0,r.createPortal)((0,o.jsx)(p,{type:"primary",icon:(0,o.jsx)(l.Z,{}),title:"返回顶部",tabIndex:0,role:"button","aria-label":"返回顶部"}),document.body):null},"backTop"):null]}},26219:function(e,n,t){"use strict";var o=t(85893),r=t(66252),s=t(94914);n.Z=function(e){return(0,o.jsx)(s.Z,{goToTop:!0,goBack:!0,children:(0,o.jsx)(r.default,{children:e.children})})}},1294:function(e){e.exports={main:"main_main__IZXSv",goToTop:"main_goToTop__Py8c8"}},64217:function(e,n,t){"use strict";t.d(n,{Z:function(){return a}});var o=t(1413),r="".concat("accept acceptCharset accessKey action allowFullScreen allowTransparency\n    alt async autoComplete autoFocus autoPlay capture cellPadding cellSpacing challenge\n    charSet checked classID className colSpan cols content contentEditable contextMenu\n    controls coords crossOrigin data dateTime default defer dir disabled download draggable\n    encType form formAction formEncType formMethod formNoValidate formTarget frameBorder\n    headers height hidden high href hrefLang htmlFor httpEquiv icon id inputMode integrity\n    is keyParams keyType kind label lang list loop low manifest marginHeight marginWidth max maxLength media\n    mediaGroup method min minLength multiple muted name noValidate nonce open\n    optimum pattern placeholder poster preload radioGroup readOnly rel required\n    reversed role rowSpan rows sandbox scope scoped scrolling seamless selected\n    shape size sizes span spellCheck src srcDoc srcLang srcSet start step style\n    summary tabIndex target title type useMap value width wmode wrap"," ").concat("onCopy onCut onPaste onCompositionEnd onCompositionStart onCompositionUpdate onKeyDown\n    onKeyPress onKeyUp onFocus onBlur onChange onInput onSubmit onClick onContextMenu onDoubleClick\n    onDrag onDragEnd onDragEnter onDragExit onDragLeave onDragOver onDragStart onDrop onMouseDown\n    onMouseEnter onMouseLeave onMouseMove onMouseOut onMouseOver onMouseUp onSelect onTouchCancel\n    onTouchEnd onTouchMove onTouchStart onScroll onWheel onAbort onCanPlay onCanPlayThrough\n    onDurationChange onEmptied onEncrypted onEnded onError onLoadedData onLoadedMetadata\n    onLoadStart onPause onPlay onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend onTimeUpdate onVolumeChange onWaiting onLoad onError").split(/[\s\n]+/);function s(e,n){return 0===e.indexOf(n)}function a(e){var n,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n=!1===t?{aria:!0,data:!0,attr:!0}:!0===t?{aria:!0}:(0,o.Z)({},t);var a={};return Object.keys(e).forEach(function(t){(n.aria&&("role"===t||s(t,"aria-"))||n.data&&s(t,"data-")||n.attr&&r.includes(t))&&(a[t]=e[t])}),a}}},function(e){e.O(0,[6338,5361,8265,2888,9774,179],function(){return e(e.s=22515)}),_N_E=e.O()}]);