(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6764],{32983:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var a=n(94184),r=n.n(a),l=n(67294),i=n(53124),s=n(10110),c=n(10274),o=n(46605),u=n(67968),m=n(45503);let genSharedEmptyStyle=e=>{let{componentCls:t,margin:n,marginXS:a,marginXL:r,fontSize:l,lineHeight:i}=e;return{[t]:{marginInline:a,fontSize:l,lineHeight:i,textAlign:"center",[`${t}-image`]:{height:e.emptyImgHeight,marginBottom:a,opacity:e.opacityImage,img:{height:"100%"},svg:{maxWidth:"100%",height:"100%",margin:"auto"}},[`${t}-description`]:{color:e.colorText},[`${t}-footer`]:{marginTop:n},"&-normal":{marginBlock:r,color:e.colorTextDisabled,[`${t}-description`]:{color:e.colorTextDisabled},[`${t}-image`]:{height:e.emptyImgHeightMD}},"&-small":{marginBlock:a,color:e.colorTextDisabled,[`${t}-image`]:{height:e.emptyImgHeightSM}}}}};var h=(0,u.Z)("Empty",e=>{let{componentCls:t,controlHeightLG:n}=e,a=(0,m.TS)(e,{emptyImgCls:`${t}-img`,emptyImgHeight:2.5*n,emptyImgHeightMD:n,emptyImgHeightSM:.875*n});return[genSharedEmptyStyle(a)]}),__rest=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)0>t.indexOf(a[r])&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]]);return n};let d=l.createElement(()=>{let[,e]=(0,o.Z)(),t=new c.C(e.colorBgBase),n=t.toHsl().l<.5?{opacity:.65}:{};return l.createElement("svg",{style:n,width:"184",height:"152",viewBox:"0 0 184 152",xmlns:"http://www.w3.org/2000/svg"},l.createElement("g",{fill:"none",fillRule:"evenodd"},l.createElement("g",{transform:"translate(24 31.67)"},l.createElement("ellipse",{fillOpacity:".8",fill:"#F5F5F7",cx:"67.797",cy:"106.89",rx:"67.797",ry:"12.668"}),l.createElement("path",{d:"M122.034 69.674L98.109 40.229c-1.148-1.386-2.826-2.225-4.593-2.225h-51.44c-1.766 0-3.444.839-4.592 2.225L13.56 69.674v15.383h108.475V69.674z",fill:"#AEB8C2"}),l.createElement("path",{d:"M101.537 86.214L80.63 61.102c-1.001-1.207-2.507-1.867-4.048-1.867H31.724c-1.54 0-3.047.66-4.048 1.867L6.769 86.214v13.792h94.768V86.214z",fill:"url(#linearGradient-1)",transform:"translate(13.56)"}),l.createElement("path",{d:"M33.83 0h67.933a4 4 0 0 1 4 4v93.344a4 4 0 0 1-4 4H33.83a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4z",fill:"#F5F5F7"}),l.createElement("path",{d:"M42.678 9.953h50.237a2 2 0 0 1 2 2V36.91a2 2 0 0 1-2 2H42.678a2 2 0 0 1-2-2V11.953a2 2 0 0 1 2-2zM42.94 49.767h49.713a2.262 2.262 0 1 1 0 4.524H42.94a2.262 2.262 0 0 1 0-4.524zM42.94 61.53h49.713a2.262 2.262 0 1 1 0 4.525H42.94a2.262 2.262 0 0 1 0-4.525zM121.813 105.032c-.775 3.071-3.497 5.36-6.735 5.36H20.515c-3.238 0-5.96-2.29-6.734-5.36a7.309 7.309 0 0 1-.222-1.79V69.675h26.318c2.907 0 5.25 2.448 5.25 5.42v.04c0 2.971 2.37 5.37 5.277 5.37h34.785c2.907 0 5.277-2.421 5.277-5.393V75.1c0-2.972 2.343-5.426 5.25-5.426h26.318v33.569c0 .617-.077 1.216-.221 1.789z",fill:"#DCE0E6"})),l.createElement("path",{d:"M149.121 33.292l-6.83 2.65a1 1 0 0 1-1.317-1.23l1.937-6.207c-2.589-2.944-4.109-6.534-4.109-10.408C138.802 8.102 148.92 0 161.402 0 173.881 0 184 8.102 184 18.097c0 9.995-10.118 18.097-22.599 18.097-4.528 0-8.744-1.066-12.28-2.902z",fill:"#DCE0E6"}),l.createElement("g",{transform:"translate(149.65 15.383)",fill:"#FFF"},l.createElement("ellipse",{cx:"20.654",cy:"3.167",rx:"2.849",ry:"2.815"}),l.createElement("path",{d:"M5.698 5.63H0L2.898.704zM9.259.704h4.985V5.63H9.259z"}))))},null),p=l.createElement(()=>{let[,e]=(0,o.Z)(),{colorFill:t,colorFillTertiary:n,colorFillQuaternary:a,colorBgContainer:r}=e,{borderColor:i,shadowColor:s,contentColor:u}=(0,l.useMemo)(()=>({borderColor:new c.C(t).onBackground(r).toHexShortString(),shadowColor:new c.C(n).onBackground(r).toHexShortString(),contentColor:new c.C(a).onBackground(r).toHexShortString()}),[t,n,a,r]);return l.createElement("svg",{width:"64",height:"41",viewBox:"0 0 64 41",xmlns:"http://www.w3.org/2000/svg"},l.createElement("g",{transform:"translate(0 1)",fill:"none",fillRule:"evenodd"},l.createElement("ellipse",{fill:s,cx:"32",cy:"33",rx:"32",ry:"7"}),l.createElement("g",{fillRule:"nonzero",stroke:i},l.createElement("path",{d:"M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"}),l.createElement("path",{d:"M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z",fill:u}))))},null),empty_Empty=e=>{var{className:t,rootClassName:n,prefixCls:a,image:c=d,description:o,children:u,imageStyle:m,style:f}=e,v=__rest(e,["className","rootClassName","prefixCls","image","description","children","imageStyle","style"]);let{getPrefixCls:g,direction:x,empty:y}=l.useContext(i.E_),S=g("empty",a),[E,_]=h(S),[C]=(0,s.Z)("Empty"),j=void 0!==o?o:null==C?void 0:C.description,b="string"==typeof j?j:"empty",w=null;return w="string"==typeof c?l.createElement("img",{alt:b,src:c}):c,E(l.createElement("div",Object.assign({className:r()(_,S,null==y?void 0:y.className,{[`${S}-normal`]:c===p,[`${S}-rtl`]:"rtl"===x},t,n),style:Object.assign(Object.assign({},null==y?void 0:y.style),f)},v),l.createElement("div",{className:`${S}-image`,style:m},w),j&&l.createElement("div",{className:`${S}-description`},j),u&&l.createElement("div",{className:`${S}-footer`},u)))};empty_Empty.PRESENTED_IMAGE_DEFAULT=d,empty_Empty.PRESENTED_IMAGE_SIMPLE=p;var f=empty_Empty},13805:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var a=n(87462),r=n(67294),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},i=n(93771),s=r.forwardRef(function(e,t){return r.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:l}))})},39223:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return UseSyncExternalStoreComponentCommunicationPage}});var a=n(67294),r=n(9008),l=n.n(r),i=n(48726),s=n(86471),c=n(8333);n(64043),n(57267);var o=n(28415),u=n(42561),m=n(18610),h=n(81852),d=n.n(h),p=n(68420),f=n(27344),v=n(44845),g=n(90143),x=n.n(g),y=n(51791),S=n.n(y),E=n(99595),_=n.n(E),C=new(function(){function Store(){var e=this;(0,p.Z)(this,Store),(0,v.Z)(this,"valueCache",null),(0,v.Z)(this,"listeners",[]),(0,v.Z)(this,"subscribe",function(t){return e.listeners.push(t),function(){var n,a;x()(n=e.listeners).call(n,S()(a=e.listeners).call(a,t),1)}}),(0,v.Z)(this,"getSnapshot",function(){return e.valueCache})}return(0,f.Z)(Store,[{key:"emit",value:function(){var e;_()(e=this.listeners).call(e,function(e){return e()})}},{key:"setValueCache",value:function(e){this.valueCache={value:e},this.emit()}},{key:"clearValueCache",value:function(){this.valueCache=null}}]),Store}()),j=n(85893),Demo_InputText=function(e){var t=(0,a.useState)(""),n=(0,c.Z)(t,2),r=n[0],l=n[1];return(0,j.jsx)(o.Z,{className:d().mb16,title:"输入文本",children:(0,j.jsxs)("div",{className:"flex",children:[(0,j.jsx)("div",{className:"grow",children:(0,j.jsx)(u.Z,{value:r,"aria-label":"输入文本",onChange:function(e){return l(e.target.value)}})}),(0,j.jsx)("div",{className:"shrink-0 ml-[6px]",children:(0,j.jsx)(m.ZP,{onClick:function(e){r&&!/^\s*$/i.test(r)&&(C.setValueCache({value:r,id:"".concat(Math.random()).replace(/^0./,"")}),l(""))},children:"添加"})})]})})},b=n(41420),w=n(88946),Z=n.n(w),N=n(8571),k=n.n(N),I=n(79977),H=n(32983),Demo_View=function(e){var t=(0,a.useSyncExternalStore)(C.subscribe,C.getSnapshot,C.getSnapshot),n=(0,a.useState)([]),r=(0,c.Z)(n,2),l=r[0],i=r[1];return(0,a.useMemo)(function(){null!==t&&(i(function(e){var n;return k()(n=[]).call(n,(0,b.Z)(e),[t.value])}),C.clearValueCache())},[t]),(0,j.jsx)(o.Z,{title:"展示文字",children:l.length>0?Z()(l).call(l,function(e,t){return(0,j.jsx)(I.Z,{className:d().mb8,children:e.value},e.id)}):(0,j.jsx)(H.Z,{})})},M=n(67552),T=n.n(M),V=n(11151);function _createMdxContent(e){var t=T()({pre:"pre",code:"code"},(0,V.ah)(),e.components);return(0,j.jsx)(t.pre,{children:(0,j.jsx)(t.code,{className:"language-javascript",children:"import { Fragment, useState, useEffect, useSyncExternalStore, useId } from 'react';\nimport { createRoot } from 'react-dom/client';\n\nclass Store {\n  valueCache = null;\n  listeners = [];\n\n  subscribe = (listener) => {\n    this.listeners.push(listener);\n\n    return () => {\n      this.listeners.splice(this.listeners.indexOf(listener), 1);\n    };\n  };\n\n  getSnapshot = () => {\n    return this.valueCache;\n  };\n\n  emit() {\n    this.listeners.forEach((listener) => listener());\n  }\n\n  addValue(value) {\n    this.valueCache = { value };\n    this.emit();\n  }\n\n  clearValue() {\n    this.valueCache = null;\n  }\n}\n\nconst store = new Store();\n\nfunction View(props) {\n  const valueCache = useSyncExternalStore(store.subscribe, store.getSnapshot);\n  const [state, setState] = useState([]);\n\n  useEffect(function() {\n    if (valueCache !== null && valueCache.value) {\n      setState((prevState) => [...prevState, valueCache.value]);\n      store.clearValue();\n    }\n  }, [valueCache]);\n\n  return <div>{ state.join(', ') }</div>;\n}\n\nfunction AddValue(props) {\n  const id = useId();\n\n  function handleClick(event) {\n    const value = document.getElementById(`${ id }-input`).value;\n\n    if (value && value !== '') {\n      store.addValue(value);\n    }\n  }\n\n  return (\n    <Fragment>\n      <input id={ `${ id }-input` } />\n      <button type=\"button\" onClick={ handleClick }>点击</button>\n    </Fragment>\n  );\n}\n\nfunction App(props) {\n  return (\n    <div>\n      <AddValue />\n      <View />\n    </div>\n  );\n}\n\nconst root = createRoot(document.getElementById('app'));\n\nroot.render(<App />);\n"})})}var componentCommunication=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=T()({},(0,V.ah)(),e.components).wrapper;return t?(0,j.jsx)(t,T()({},e,{children:(0,j.jsx)(_createMdxContent,e)})):_createMdxContent(e)},L=i.Z.Title,z=i.Z.Paragraph,UseSyncExternalStoreComponentCommunication_UseSyncExternalStoreComponentCommunication=function(e){return(0,j.jsxs)(s.Z,{children:[(0,j.jsx)(L,{children:"使用useSyncExternalStore实现组件通信"}),(0,j.jsx)(z,{children:"在React18的版本中，新添加了一个Hook API：useSyncExternalStore，推荐用于从外部数据源读取和订阅的Hook。"}),(0,j.jsx)(z,{children:"通过使用useSyncExternalStore，也可以用它实现组件间的通信。"}),(0,j.jsx)(componentCommunication,{}),(0,j.jsx)(L,{level:2,children:"代码演示"}),(0,j.jsx)(z,{children:"这个例子展示了如何在一个组件内操作，然后将结果传递给另一个组件。"}),(0,j.jsx)(Demo_InputText,{}),(0,j.jsx)(Demo_View,{})]})};function UseSyncExternalStoreComponentCommunicationPage(e){return(0,j.jsxs)(a.Fragment,{children:[(0,j.jsxs)(l(),{children:[(0,j.jsx)("title",{children:"使用useSyncExternalStore实现组件通信"}),(0,j.jsx)("meta",{name:"keywords",content:"前端, js, javascript, react, useSyncExternalStore"}),(0,j.jsx)("meta",{name:"description",content:"使用useSyncExternalStore实现组件通信"})]}),(0,j.jsx)(UseSyncExternalStoreComponentCommunication_UseSyncExternalStoreComponentCommunication,{})]})}},51775:function(e,t,n){"use strict";var a=n(19623),r=n(73935),l=n(11163),i=n(35846),s=n(18610),c=n(75162),o=n(37653),u=n(76467),m=n(96865),h=n.n(m),d=n(85893),p=i.Z.BackTop;t.Z=function(e){var t=(0,l.useRouter)();return[(0,d.jsxs)("div",{className:h().main,children:[e.goBack?(0,d.jsx)("div",{className:"mb-[16px] text-right",children:(0,d.jsxs)(s.ZP,{onClick:function(e){t.push("/")},children:[(0,d.jsx)(o.Z,{className:"mr-[6px]"}),"返回"]})}):null,null==e?void 0:e.children]},"main"),(0,d.jsx)(u.default,{children:null!=e&&e.goToTop&&("undefined"==typeof document?"undefined":(0,a.Z)(document))==="object"?(0,r.createPortal)((0,d.jsx)(p,{type:"primary",icon:(0,d.jsx)(c.Z,{}),title:"返回顶部",tabIndex:0,role:"button","aria-label":"返回顶部"}),document.body):null},"backTop")]}},5189:function(e,t,n){"use strict";n(64043);var a=n(88946),r=n.n(a),l=n(81290),i=n.n(l),s=n(41664),c=n.n(s),o=n(21612),u=n(78957),m=n(83062),h=n(67337),d=n(10534),p=n.n(d),f=n(43989),v=n(85893),g=[{href:"/",title:"文章"},{href:"/favorites",title:"收藏夹"},{href:"/project",title:"开源项目"}],x=["github.io","vercel.app"],y=r()(g).call(g,function(e,t){return(0,v.jsx)("li",{className:p().navListItem,children:(0,v.jsx)(c(),{href:e.href,children:e.title})},e.href)});t.Z=function(e){return(0,v.jsx)(o.Z.Header,{className:p().antdHeader,children:(0,v.jsxs)("div",{className:p().header,children:[(0,v.jsx)("nav",{className:p().headerLeft,children:(0,v.jsx)("ul",{className:p().navList,children:y})}),(0,v.jsx)("div",{className:p().headerRight,children:(0,v.jsxs)(u.Z,{size:16,children:[(0,v.jsx)(m.Z,{title:"切换网站地址",children:(0,v.jsx)("a",{className:p().switchAddress,role:"button",tabIndex:0,"aria-label":"切换网站地址",onClick:function(e){var t=window.location,n=t.pathname,a=t.hostname,r=/github\.io/.test(a);window.location.href=new(i())(n,"https://duan602728596.".concat(x[r?1:0],"/"))},children:(0,v.jsx)(h.Z,{className:p().switchAddressIcon})})}),(0,v.jsx)("a",{className:p().githubLink,href:"https://github.com/duan602728596",target:"_blank",rel:"noopener noreferrer",children:(0,v.jsx)(f.Z,{className:"block w-full h-full",imageClassName:"block w-full h-full",avifSrc:"/images/github.avif",webpSrc:"/images/github.webp",src:"/images/github.png",alt:"github"})})]})})]})})}},43989:function(e,t,n){"use strict";var a=n(85893);t.Z=function(e){var t=e.className,n=e.imageClassName,r=e.avifSrc,l=e.webpSrc,i=e.src,s=e.alt;return(0,a.jsxs)("picture",{className:t,children:[r&&(0,a.jsx)("source",{srcSet:r,type:"image/avif"}),l&&(0,a.jsx)("source",{srcSet:l,type:"image/webp"}),(0,a.jsx)("img",{className:n,src:i,alt:s})]})}},86471:function(e,t,n){"use strict";var a=n(67294),r=n(5189),l=n(51775),i=n(85893);t.Z=function(e){return(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)(r.Z,{}),(0,i.jsx)(l.Z,{goToTop:!0,goBack:!0,children:e.children})]})}},63655:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/react/useSyncExternalStore-component-communication",function(){return n(39223)}])},96865:function(e){e.exports={main:"main_main__IZXSv",goToTop:"main_goToTop__Py8c8"}},10534:function(e){e.exports={antdHeader:"nav_antdHeader__eCvl0",header:"nav_header__y1mlw",headerLeft:"nav_headerLeft__PrT7_",headerRight:"nav_headerRight__JfqYP",navList:"nav_navList__3HXot",navListItem:"nav_navListItem__hpAdz",switchAddress:"nav_switchAddress__sVzqD",githubLink:"nav_githubLink__BDzSl",switchAddressIcon:"nav_switchAddressIcon__KLxGG"}},81852:function(e){e.exports={mb16:"demo_mb16__SgZY_",mb8:"demo_mb8__rO9yc"}}},function(e){e.O(0,[4322,1447,9166,3791,971,8415,4107,9774,2888,179],function(){return e(e.s=63655)}),_N_E=e.O()}]);