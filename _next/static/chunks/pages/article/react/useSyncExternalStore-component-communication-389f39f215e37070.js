(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6764],{68795:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var a=t(87462),r=t(67294),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},i=t(42135),s=r.forwardRef(function(e,n){return r.createElement(i.Z,(0,a.Z)({},e,{ref:n,icon:l}))})},32983:function(e,n,t){"use strict";t.d(n,{Z:function(){return x}});var a=t(94184),r=t.n(a),l=t(67294),i=t(53124),s=t(10110),c=t(10274),o=t(46605),u=t(91945),h=t(45503);let d=e=>{let{componentCls:n,margin:t,marginXS:a,marginXL:r,fontSize:l,lineHeight:i}=e;return{[n]:{marginInline:a,fontSize:l,lineHeight:i,textAlign:"center",[`${n}-image`]:{height:e.emptyImgHeight,marginBottom:a,opacity:e.opacityImage,img:{height:"100%"},svg:{maxWidth:"100%",height:"100%",margin:"auto"}},[`${n}-description`]:{color:e.colorText},[`${n}-footer`]:{marginTop:t},"&-normal":{marginBlock:r,color:e.colorTextDisabled,[`${n}-description`]:{color:e.colorTextDisabled},[`${n}-image`]:{height:e.emptyImgHeightMD}},"&-small":{marginBlock:a,color:e.colorTextDisabled,[`${n}-image`]:{height:e.emptyImgHeightSM}}}}};var m=(0,u.I$)("Empty",e=>{let{componentCls:n,controlHeightLG:t,calc:a}=e;return[d((0,h.TS)(e,{emptyImgCls:`${n}-img`,emptyImgHeight:a(t).mul(2.5).equal(),emptyImgHeightMD:t,emptyImgHeightSM:a(t).mul(.875).equal()}))]}),f=function(e,n){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>n.indexOf(a)&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)0>n.indexOf(a[r])&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(t[a[r]]=e[a[r]]);return t};let v=l.createElement(()=>{let[,e]=(0,o.ZP)(),n=new c.C(e.colorBgBase).toHsl().l<.5?{opacity:.65}:{};return l.createElement("svg",{style:n,width:"184",height:"152",viewBox:"0 0 184 152",xmlns:"http://www.w3.org/2000/svg"},l.createElement("g",{fill:"none",fillRule:"evenodd"},l.createElement("g",{transform:"translate(24 31.67)"},l.createElement("ellipse",{fillOpacity:".8",fill:"#F5F5F7",cx:"67.797",cy:"106.89",rx:"67.797",ry:"12.668"}),l.createElement("path",{d:"M122.034 69.674L98.109 40.229c-1.148-1.386-2.826-2.225-4.593-2.225h-51.44c-1.766 0-3.444.839-4.592 2.225L13.56 69.674v15.383h108.475V69.674z",fill:"#AEB8C2"}),l.createElement("path",{d:"M101.537 86.214L80.63 61.102c-1.001-1.207-2.507-1.867-4.048-1.867H31.724c-1.54 0-3.047.66-4.048 1.867L6.769 86.214v13.792h94.768V86.214z",fill:"url(#linearGradient-1)",transform:"translate(13.56)"}),l.createElement("path",{d:"M33.83 0h67.933a4 4 0 0 1 4 4v93.344a4 4 0 0 1-4 4H33.83a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4z",fill:"#F5F5F7"}),l.createElement("path",{d:"M42.678 9.953h50.237a2 2 0 0 1 2 2V36.91a2 2 0 0 1-2 2H42.678a2 2 0 0 1-2-2V11.953a2 2 0 0 1 2-2zM42.94 49.767h49.713a2.262 2.262 0 1 1 0 4.524H42.94a2.262 2.262 0 0 1 0-4.524zM42.94 61.53h49.713a2.262 2.262 0 1 1 0 4.525H42.94a2.262 2.262 0 0 1 0-4.525zM121.813 105.032c-.775 3.071-3.497 5.36-6.735 5.36H20.515c-3.238 0-5.96-2.29-6.734-5.36a7.309 7.309 0 0 1-.222-1.79V69.675h26.318c2.907 0 5.25 2.448 5.25 5.42v.04c0 2.971 2.37 5.37 5.277 5.37h34.785c2.907 0 5.277-2.421 5.277-5.393V75.1c0-2.972 2.343-5.426 5.25-5.426h26.318v33.569c0 .617-.077 1.216-.221 1.789z",fill:"#DCE0E6"})),l.createElement("path",{d:"M149.121 33.292l-6.83 2.65a1 1 0 0 1-1.317-1.23l1.937-6.207c-2.589-2.944-4.109-6.534-4.109-10.408C138.802 8.102 148.92 0 161.402 0 173.881 0 184 8.102 184 18.097c0 9.995-10.118 18.097-22.599 18.097-4.528 0-8.744-1.066-12.28-2.902z",fill:"#DCE0E6"}),l.createElement("g",{transform:"translate(149.65 15.383)",fill:"#FFF"},l.createElement("ellipse",{cx:"20.654",cy:"3.167",rx:"2.849",ry:"2.815"}),l.createElement("path",{d:"M5.698 5.63H0L2.898.704zM9.259.704h4.985V5.63H9.259z"}))))},null),p=l.createElement(()=>{let[,e]=(0,o.ZP)(),{colorFill:n,colorFillTertiary:t,colorFillQuaternary:a,colorBgContainer:r}=e,{borderColor:i,shadowColor:s,contentColor:u}=(0,l.useMemo)(()=>({borderColor:new c.C(n).onBackground(r).toHexShortString(),shadowColor:new c.C(t).onBackground(r).toHexShortString(),contentColor:new c.C(a).onBackground(r).toHexShortString()}),[n,t,a,r]);return l.createElement("svg",{width:"64",height:"41",viewBox:"0 0 64 41",xmlns:"http://www.w3.org/2000/svg"},l.createElement("g",{transform:"translate(0 1)",fill:"none",fillRule:"evenodd"},l.createElement("ellipse",{fill:s,cx:"32",cy:"33",rx:"32",ry:"7"}),l.createElement("g",{fillRule:"nonzero",stroke:i},l.createElement("path",{d:"M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"}),l.createElement("path",{d:"M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z",fill:u}))))},null),g=e=>{var{className:n,rootClassName:t,prefixCls:a,image:c=v,description:o,children:u,imageStyle:h,style:d}=e,g=f(e,["className","rootClassName","prefixCls","image","description","children","imageStyle","style"]);let{getPrefixCls:x,direction:j,empty:b}=l.useContext(i.E_),y=x("empty",a),[E,S]=m(y),[_]=(0,s.Z)("Empty"),C=void 0!==o?o:null==_?void 0:_.description,w=null;return w="string"==typeof c?l.createElement("img",{alt:"string"==typeof C?C:"empty",src:c}):c,E(l.createElement("div",Object.assign({className:r()(S,y,null==b?void 0:b.className,{[`${y}-normal`]:c===p,[`${y}-rtl`]:"rtl"===j},n,t),style:Object.assign(Object.assign({},null==b?void 0:b.style),d)},g),l.createElement("div",{className:`${y}-image`,style:h},w),C&&l.createElement("div",{className:`${y}-description`},C),u&&l.createElement("div",{className:`${y}-footer`},u)))};g.PRESENTED_IMAGE_DEFAULT=v,g.PRESENTED_IMAGE_SIMPLE=p;var x=g},12448:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return et}});var a=t(67294),r=t(9008),l=t.n(r),i=t(76315),s=t(55147),c=t(8333);t(64043),t(57267);var o=t(70859),u=t(68863),h=t(18610),d=t(19608),m=t.n(d),f=t(68420),v=t(27344),p=t(44845),g=t(90143),x=t.n(g),j=t(51791),b=t.n(j),y=t(99595),E=t.n(y),S=new(function(){function e(){var n=this;(0,f.Z)(this,e),(0,p.Z)(this,"valueCache",null),(0,p.Z)(this,"listeners",[]),(0,p.Z)(this,"subscribe",function(e){return n.listeners.push(e),function(){var t,a;x()(t=n.listeners).call(t,b()(a=n.listeners).call(a,e),1)}}),(0,p.Z)(this,"getSnapshot",function(){return n.valueCache})}return(0,v.Z)(e,[{key:"emit",value:function(){var e;E()(e=this.listeners).call(e,function(e){return e()})}},{key:"setValueCache",value:function(e){this.valueCache={value:e},this.emit()}},{key:"clearValueCache",value:function(){this.valueCache=null}}]),e}()),_=t(85893),C=function(e){var n=(0,a.useState)(""),t=(0,c.Z)(n,2),r=t[0],l=t[1];return(0,_.jsx)(o.Z,{className:m().mb16,title:"输入文本",children:(0,_.jsxs)("div",{className:"flex",children:[(0,_.jsx)("div",{className:"grow",children:(0,_.jsx)(u.Z,{value:r,"aria-label":"输入文本",onChange:function(e){return l(e.target.value)}})}),(0,_.jsx)("div",{className:"shrink-0 ml-[6px]",children:(0,_.jsx)(h.ZP,{onClick:function(e){r&&!/^\s*$/i.test(r)&&(S.setValueCache({value:r,id:"".concat(Math.random()).replace(/^0./,"")}),l(""))},children:"添加"})})]})})},w=t(41420),Z=t(88946),N=t.n(Z),k=t(8571),I=t.n(k),H=t(79977),M=t(32983),L=function(e){var n=(0,a.useSyncExternalStore)(S.subscribe,S.getSnapshot,S.getSnapshot),t=(0,a.useState)([]),r=(0,c.Z)(t,2),l=r[0],i=r[1];return(0,a.useMemo)(function(){null!==n&&(i(function(e){var t;return I()(t=[]).call(t,(0,w.Z)(e),[n.value])}),S.clearValueCache())},[n]),(0,_.jsx)(o.Z,{title:"展示文字",children:l.length>0?N()(l).call(l,function(e,n){return(0,_.jsx)(H.Z,{className:m().mb8,children:e.value},e.id)}):(0,_.jsx)(M.Z,{})})},T=t(62079),V=t.n(T),z=t(52020),O=t.n(z),B=t(73324),P=t.n(B),A=t(88546),$=t.n(A),F=t(66775),R=t.n(F),D=t(2201),G=t.n(D),q=t(57445),X=t.n(q),Y=t(11151);function J(e,n){var t=V()(e);if(O()){var a=O()(e);n&&(a=P()(a).call(a,function(n){return $()(e,n).enumerable})),t.push.apply(t,a)}return t}function K(e){for(var n=1;n<arguments.length;n++){var t,a,r=null!=arguments[n]?arguments[n]:{};n%2?E()(t=J(Object(r),!0)).call(t,function(n){(0,p.Z)(e,n,r[n])}):R()?G()(e,R()(r)):E()(a=J(Object(r))).call(a,function(n){X()(e,n,$()(r,n))})}return e}function U(e){var n=K(K({code:"code",pre:"pre"},(0,Y.a)()),e.components);return(0,_.jsx)(n.pre,{children:(0,_.jsx)(n.code,{className:"language-javascript",children:"import { Fragment, useState, useEffect, useSyncExternalStore, useId } from 'react';\nimport { createRoot } from 'react-dom/client';\n\nclass Store {\n  valueCache = null;\n  listeners = [];\n\n  subscribe = (listener) => {\n    this.listeners.push(listener);\n\n    return () => {\n      this.listeners.splice(this.listeners.indexOf(listener), 1);\n    };\n  };\n\n  getSnapshot = () => {\n    return this.valueCache;\n  };\n\n  emit() {\n    this.listeners.forEach((listener) => listener());\n  }\n\n  addValue(value) {\n    this.valueCache = { value };\n    this.emit();\n  }\n\n  clearValue() {\n    this.valueCache = null;\n  }\n}\n\nconst store = new Store();\n\nfunction View(props) {\n  const valueCache = useSyncExternalStore(store.subscribe, store.getSnapshot);\n  const [state, setState] = useState([]);\n\n  useEffect(function() {\n    if (valueCache !== null && valueCache.value) {\n      setState((prevState) => [...prevState, valueCache.value]);\n      store.clearValue();\n    }\n  }, [valueCache]);\n\n  return <div>{ state.join(', ') }</div>;\n}\n\nfunction AddValue(props) {\n  const id = useId();\n\n  function handleClick(event) {\n    const value = document.getElementById(`${ id }-input`).value;\n\n    if (value && value !== '') {\n      store.addValue(value);\n    }\n  }\n\n  return (\n    <Fragment>\n      <input id={ `${ id }-input` } />\n      <button type=\"button\" onClick={ handleClick }>点击</button>\n    </Fragment>\n  );\n}\n\nfunction App(props) {\n  return (\n    <div>\n      <AddValue />\n      <View />\n    </div>\n  );\n}\n\nconst root = createRoot(document.getElementById('app'));\n\nroot.render(<App />);\n"})})}function W(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=K(K({},(0,Y.a)()),e.components).wrapper;return n?(0,_.jsx)(n,K(K({},e),{},{children:(0,_.jsx)(U,K({},e))})):U(e)}var Q=i.Z.Title,ee=i.Z.Paragraph,en=function(e){return(0,_.jsxs)(s.Z,{children:[(0,_.jsx)(Q,{children:"使用useSyncExternalStore实现组件通信"}),(0,_.jsx)(ee,{children:"在React18的版本中，新添加了一个Hook API：useSyncExternalStore，推荐用于从外部数据源读取和订阅的Hook。"}),(0,_.jsx)(ee,{children:"通过使用useSyncExternalStore，也可以用它实现组件间的通信。"}),(0,_.jsx)(W,{}),(0,_.jsx)(Q,{level:2,children:"代码演示"}),(0,_.jsx)(ee,{children:"这个例子展示了如何在一个组件内操作，然后将结果传递给另一个组件。"}),(0,_.jsx)(C,{}),(0,_.jsx)(L,{})]})};function et(e){return(0,_.jsxs)(a.Fragment,{children:[(0,_.jsxs)(l(),{children:[(0,_.jsx)("title",{children:"使用useSyncExternalStore实现组件通信"}),(0,_.jsx)("meta",{name:"keywords",content:"前端, js, javascript, react, useSyncExternalStore"}),(0,_.jsx)("meta",{name:"description",content:"使用useSyncExternalStore实现组件通信"})]}),(0,_.jsx)(en,{})]})}},39243:function(e,n,t){"use strict";var a=t(19623),r=t(73935),l=t(11163),i=t(81860),s=t(18610),c=t(75162),o=t(6171),u=t(76467),h=t(63791),d=t.n(h),m=t(85893),f=i.Z.BackTop;n.Z=function(e){var n=(0,l.useRouter)();return[(0,m.jsxs)("div",{className:d().main,children:[e.goBack?(0,m.jsx)("div",{className:"mb-[16px] text-right",children:(0,m.jsxs)(s.ZP,{onClick:function(e){n.push("/")},children:[(0,m.jsx)(o.Z,{className:"mr-[6px]"}),"返回"]})}):null,null==e?void 0:e.children]},"main"),(0,m.jsx)(u.default,{children:null!=e&&e.goToTop&&("undefined"==typeof document?"undefined":(0,a.Z)(document))==="object"?(0,r.createPortal)((0,m.jsx)(f,{type:"primary",icon:(0,m.jsx)(c.Z,{}),title:"返回顶部",tabIndex:0,role:"button","aria-label":"返回顶部"}),document.body):null},"backTop")]}},31725:function(e,n,t){"use strict";t(64043);var a=t(88946),r=t.n(a),l=t(81290),i=t.n(l),s=t(41664),c=t.n(s),o=t(21612),u=t(78957),h=t(83062),d=t(67337),m=t(32958),f=t.n(m),v=t(96808),p=t(85893),g=[{href:"/",title:"文章"},{href:"/favorites",title:"收藏夹"},{href:"/project",title:"开源项目"}],x=["github.io","vercel.app"],j=r()(g).call(g,function(e,n){return(0,p.jsx)("li",{className:f().navListItem,children:(0,p.jsx)(c(),{href:e.href,children:e.title})},e.href)});n.Z=function(e){return(0,p.jsx)(o.Z.Header,{className:f().antdHeader,children:(0,p.jsxs)("div",{className:f().header,children:[(0,p.jsx)("nav",{className:f().headerLeft,children:(0,p.jsx)("ul",{className:f().navList,children:j})}),(0,p.jsx)("div",{className:f().headerRight,children:(0,p.jsxs)(u.Z,{size:16,children:[(0,p.jsx)(h.Z,{title:"切换网站地址",children:(0,p.jsx)("a",{className:f().switchAddress,role:"button",tabIndex:0,"aria-label":"切换网站地址",onClick:function(e){var n=window.location,t=n.pathname,a=n.hostname,r=/github\.io/.test(a);window.location.href=new(i())(t,"https://duan602728596.".concat(x[r?1:0],"/"))},children:(0,p.jsx)(d.Z,{className:f().switchAddressIcon})})}),(0,p.jsx)("a",{className:f().githubLink,href:"https://github.com/duan602728596",target:"_blank",rel:"noopener noreferrer",children:(0,p.jsx)(v.Z,{className:"block w-full h-full",imageClassName:"block w-full h-full",avifSrc:"/images/github.avif",webpSrc:"/images/github.webp",src:"/images/github.png",alt:"github"})})]})})]})})}},96808:function(e,n,t){"use strict";var a=t(85893);n.Z=function(e){var n=e.className,t=e.imageClassName,r=e.avifSrc,l=e.webpSrc,i=e.src,s=e.alt;return(0,a.jsxs)("picture",{className:n,children:[r&&(0,a.jsx)("source",{srcSet:r,type:"image/avif"}),l&&(0,a.jsx)("source",{srcSet:l,type:"image/webp"}),(0,a.jsx)("img",{className:t,src:i,alt:s})]})}},55147:function(e,n,t){"use strict";var a=t(67294),r=t(31725),l=t(39243),i=t(85893);n.Z=function(e){return(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)(r.Z,{}),(0,i.jsx)(l.Z,{goToTop:!0,goBack:!0,children:e.children})]})}},63655:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/react/useSyncExternalStore-component-communication",function(){return t(12448)}])},63791:function(e){e.exports={main:"main_main__IZXSv",goToTop:"main_goToTop__Py8c8"}},32958:function(e){e.exports={antdHeader:"nav_antdHeader__eCvl0",header:"nav_header__y1mlw",headerLeft:"nav_headerLeft__PrT7_",headerRight:"nav_headerRight__JfqYP",navList:"nav_navList__3HXot",navListItem:"nav_navListItem__hpAdz",switchAddress:"nav_switchAddress__sVzqD",githubLink:"nav_githubLink__BDzSl",switchAddressIcon:"nav_switchAddressIcon__KLxGG"}},19608:function(e){e.exports={mb16:"demo_mb16__SgZY_",mb8:"demo_mb8__rO9yc"}}},function(e){e.O(0,[8610,1447,4530,3791,8791,859,9761,9774,2888,179],function(){return e(e.s=63655)}),_N_E=e.O()}]);